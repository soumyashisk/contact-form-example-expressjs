<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Message List</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <h3 class="my-4" id="message"></h3>
      <a href="" id="email"></a>
    </div>

    <script>
      function showMessage(email, message) {
        document.getElementById("message").innerText = message;
        const emailLink = document.getElementById("email");
        emailLink.href = "mailto:" + email;
        emailLink.innerText = email;
      }
      const url = new URL(window.location.href);
      const id = url.searchParams.get("id");
      if (!id) {
        alert("No message ID provided");
        window.location.href = "/list.html";
      }
      (async () => {
        try {
          const res = await fetch("/messages/" + id);
          if (!res.ok) throw new Error("Failed to fetch messages");
          const data = await res.json();
          if (data.error) {
            alert("Error: " + data.error);
            window.location.href = "/list.html";
            return;
          }
          const message = data.data;
          showMessage(message.email, message.message);
        } catch (error) {
          alert("Error fetching messages: " + error);
        }
      })();
    </script>
  </body>
</html>
